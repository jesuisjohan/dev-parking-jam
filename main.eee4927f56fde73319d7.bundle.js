/*! For license information please see main.eee4927f56fde73319d7.bundle.js.LICENSE.txt */
(()=>{var e,t={214:(e,t,s)=>{"use strict";s(260);class i extends Phaser.GameObjects.Text{constructor(e){super(e,10,10,"",{color:"black",fontSize:"28px"}),e.add.existing(this),this.setOrigin(0)}update(){this.setText(`fps: ${Math.floor(this.scene.game.loop.actualFps)}`)}}const r={Depths:{TILE:0},TILE_SIZE:85,NOT_FIT_BOARD_SCALE:1.1,Keys:{Textures:{Car:{Red:{NORTH_WEST:"north-west-red",NORTH_EAST:"north-east-red",SOUTH_WEST:"south-west-red",SOUTH_EAST:"south-east-red"},Blue:{NORTH_WEST:"north-west-blue",NORTH_EAST:"north-east-blue",SOUTH_WEST:"south-west-blue",SOUTH_EAST:"south-east-blue"},Green:{NORTH_WEST:"north-west-green",NORTH_EAST:"north-east-green",SOUTH_WEST:"south-west-green",SOUTH_EAST:"south-east-green"},Lemon:{NORTH_WEST:"north-west-lemon",NORTH_EAST:"north-east-lemon",SOUTH_WEST:"south-west-lemon",SOUTH_EAST:"south-east-lemon"},Orange:{NORTH_WEST:"north-west-orange",NORTH_EAST:"north-east-orange",SOUTH_WEST:"south-west-orange",SOUTH_EAST:"south-east-orange"},Violet:{NORTH_WEST:"north-west-violet",NORTH_EAST:"north-east-violet",SOUTH_WEST:"south-west-violet",SOUTH_EAST:"south-east-violet"}},Blocker:{BARREL:"barrel",HYDRANT:"hydrant",MAIL_BOX:"mail-box",PLANT_POT:"plant-pot",RECYCLE_BIN:"recycle-bin",TRAFFIC_CONE:"traffic-cone"},Tile:{ONE:"tile-1",TWO:"tile-2",THREE:"tile-3",FOUR:"tile-4",DIRTY:"dirty-tile",CLEAN:"clean-tile",UNIT:"unit-tile"}}},TransformedCoordinate:{TRANSFORMED_I_HAT:new Phaser.Math.Vector2(39.5,19),TRANSFORMED_J_HAT:new Phaser.Math.Vector2(-22.5,34)},ANCHOR_POSITION:new Phaser.Math.Vector2(440,80),TWEEN_SPEED:60,Swipe:{SWIPE_MIN_DISTANCE:50,SWIPE_EPSILON:.5}};var a;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(a||(a={}));const o=a;var n;!function(e){e[e.NULL=-1]="NULL",e[e.EMPTY=0]="EMPTY",e[e.GREEN=1]="GREEN",e[e.LEMON=2]="LEMON",e[e.ORANGE=3]="ORANGE",e[e.RED=4]="RED",e[e.BLUE=5]="BLUE",e[e.VIOLET=6]="VIOLET",e[e.BLOCKER=7]="BLOCKER",e[e.GRANDMA=8]="GRANDMA"}(n||(n={}));const l=n,{ANCHOR_POSITION:c}=r;function h(e){return e.clone().add(c)}const{TRANSFORMED_I_HAT:T,TRANSFORMED_J_HAT:u}=r.TransformedCoordinate;function g(e){return new Phaser.Math.Vector2(e.row*u.x+e.column*T.x,e.row*u.y+e.column*T.y)}const d=new class{constructor(){this.levelIndex=0,this.levelConfigs=[]}addLevel(e){this.levelConfigs.push(e)}getLevel(){return this.levelConfigs[this.levelIndex]}getLevelIndex(){return this.levelIndex}setLevelIndex(e){e>=this.levelConfigs.length?this.levelIndex=0:this.levelIndex=e}increaseLevelIndex(e=1){this.setLevelIndex(this.levelIndex+e)}getMaxLevelIndex(){return this.levelConfigs.length-1}getLevelConfigsLength(){return this.levelConfigs.length}isOutOfAutoGeneratedLevels(){return this.levelIndex===this.levelConfigs.length-1}},m=d,E=new class{constructor(){this.cars=[],this.exitedCarNum=0}push(e){this.cars.push(e)}didAllCarExit(){return this.exitedCarNum===this.cars.length&&this.cars.length>0}toArray(){return this.cars}clearAllCars(){this.cars.forEach((e=>null==e?void 0:e.destroy())),this.cars=[],this.exitedCarNum=0}increaseExitedCarNum(){console.log("exit"),this.exitedCarNum++,console.log(this.exitedCarNum),console.log(this.cars.length)}};function S(e,t){return Math.abs(e.row-t.row)+Math.abs(e.column-t.column)}const{TRANSFORMED_I_HAT:O,TRANSFORMED_J_HAT:p}=r.TransformedCoordinate,{TWEEN_SPEED:b}=r;class v{constructor(e){this.car=e,this.scene=this.car.scene}playVerticalMovingAnimation(e,t){this.car.getIsVertical()&&(this.car.didExit()&&(t+=this.car.getLength()),this.playMovingAnimation(p.clone(),e,t,e?o.DOWN:o.UP))}playHorizontalMovingAnimation(e,t){this.car.getIsVertical()||(this.car.didExit()&&(t+=this.car.getLength()),this.playMovingAnimation(O.clone(),e,t,e?o.RIGHT:o.LEFT))}playMovingAnimation(e,t,s,i){this.car.setMoving(!0);const r=new Phaser.Math.Vector2(this.car.x,this.car.y),a=t?s:-s,o=e.scale(a),n=r.add(o),l=this.scene.add.tween({targets:this.car,x:n.x,y:n.y,duration:b*s,ease:Phaser.Math.Easing.Sine.InOut,onComplete:()=>{this.car.setMoving(!1),this.car.didExit()?this.playExitAnimation(i):this.car.initDepth()}});this.car.setMoveTween(l)}playExitAnimation(e){const{rows:t,columns:s}=m.getLevel().boardSize,i=Math.ceil(this.car.getLength()/2),r={row:0-i,column:0-i},a={row:0-i,column:s-1+i},n={row:t-1+i,column:0-i},l={row:t-1+i,column:s-1+i},c={row:-5,column:0-i},h=this.scene.tweens.createTimeline();if(this.car.getIsVertical())if(e===o.UP){this.car.changeDirection(o.RIGHT);const e=Math.abs(a.column-this.car.boardPosition.column);this.addPositionToTimeline(h,a,o.DOWN,e);const t=S(l,a);this.addPositionToTimeline(h,l,o.LEFT,t);const s=S(n,l);this.addPositionToTimeline(h,n,o.UP,s)}else{this.car.changeDirection(o.LEFT);const e=Math.abs(n.column-this.car.boardPosition.column);this.addPositionToTimeline(h,n,o.UP,e)}else if(e===o.LEFT){this.car.changeDirection(o.UP);const e=Math.abs(r.row-this.car.boardPosition.row);this.addPositionToTimeline(h,r,o.RIGHT,e);const t=S(a,r);this.addPositionToTimeline(h,a,o.DOWN,t);const s=S(l,a);this.addPositionToTimeline(h,l,o.LEFT,s);const i=S(n,l);this.addPositionToTimeline(h,n,o.UP,i)}else{this.car.changeDirection(o.DOWN);const e=Math.abs(l.row-this.car.boardPosition.row);this.addPositionToTimeline(h,l,o.LEFT,e);const t=S(n,l);this.addPositionToTimeline(h,n,o.UP,t)}const T=S(c,n);this.addPositionToTimeline(h,c,o.UP,T),this.playDisappearAnimation(h),h.play()}addPositionToTimeline(e,t,s,i){const r=h(g(t));e.add({targets:this.car,ease:Phaser.Math.Easing.Sine.InOut,duration:b*i,x:r.x,y:r.y,onComplete:()=>{this.car.boardPosition.row=t.row,this.car.boardPosition.column=t.column,this.car.changeDirection(s)}})}playDisappearAnimation(e){e.add({targets:this.car,alpha:0,duration:500,ease:Phaser.Math.Easing.Sine.InOut,onComplete:()=>{E.didAllCarExit()&&this.scene.showWinPopup()}})}}const R=[l.BLUE,l.GREEN,l.LEMON,l.ORANGE,l.RED,l.VIOLET];R.push(l.BLOCKER);const f=R;class w extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,i),this.boardPosition=t,this.isVertical=s,this.exited=!1,this.initWorldPosition(),this.initRotation(),this.initDepth(),this.setOverlapTilesState(this.getTileState()),e.add.existing(this)}didExit(){return this.exited}getBoardPosition(){return this.boardPosition}getIsVertical(){return this.isVertical}initWorldPosition(){const e=h(function(e,t,s,i){let r=0,a=0;return i?(r=(s-2)/2+1/4,a=(t-1)/2):(a=(s-1)/2-1/4,r=(t-1)/2-1/4),g({row:e.row+r,column:e.column+a})}(this.boardPosition,this.getWidth(),this.getLength(),this.isVertical));this.x=e.x,this.y=e.y}initRotation(){this.angle=this.isVertical?-60:30}initDepth(){const{columns:e}=m.getLevel().boardSize;this.setDepth(e*this.boardPosition.row+this.boardPosition.column)}canTileBlockRectangle(e){return f.includes(e)}moveHorizontally(e){const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.resetOverlapTilesHorizontal(e,t)}moveVertically(e){const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.resetOverlapTilesVertical(e,t)}computeTravelingBoardDistanceRight(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene,t=this.getFrontTiles(),s=t[0].column;let i=s;for(;;){i++;let s=!1,r=!1;for(const a of t){const t={row:a.row,column:i},o=e.getBoardManager().getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceLeft(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getRearTiles(),s=t[0].column;let i=s;for(;;){i--;let s=!1,r=!1;for(const a of t){const t={row:a.row,column:i},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}computeTravelingBoardDistanceDown(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getFrontTiles(),s=t[0].row;let i=s;for(;;){i++;let s=!1,r=!1;for(const a of t){const t={row:i,column:a.column},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceUp(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getRearTiles(),s=t[0].row;let i=s;for(;;){i--;let s=!1,r=!1;for(const a of t){const t={row:i,column:a.column},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}setOverlapTilesState(e){const t=this.scene;this.getOverlapTiles().forEach((s=>{t.getBoardManager().getTileState(s)!==l.NULL?t.getBoardManager().setTileState(s,e):console.log(`${s.row} ${s.column} is null`)}))}resetOverlapTilesVertical(e,t){this.setOverlapTilesState(l.EMPTY),this.exited||(e?this.boardPosition.row+=t:this.boardPosition.row-=t,this.setOverlapTilesState(this.getTileState()))}resetOverlapTilesHorizontal(e,t){this.setOverlapTilesState(l.EMPTY),this.exited||(e?this.boardPosition.column+=t:this.boardPosition.column-=t,this.setOverlapTilesState(this.getTileState()))}getRearTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getWidth();t++){const s={row:this.boardPosition.row,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++){const s={row:t,column:this.boardPosition.column};e.push(s)}return e}getFrontTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getWidth();t++){const s={row:this.boardPosition.row+this.getLength()-1,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++){const s={row:t,column:this.boardPosition.column+this.getLength()-1};e.push(s)}return e}getOverlapTiles(){const e=[];if(this.isVertical)for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getLength();t++)for(let s=this.boardPosition.column;s<this.boardPosition.column+this.getWidth();s++){const i={row:t,column:s};e.push(i)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++)for(let s=this.boardPosition.column;s<this.boardPosition.column+this.getLength();s++){const i={row:t,column:s};e.push(i)}return e}executeExit(){this.exited=!0}}const{TRANSFORMED_I_HAT:_,TRANSFORMED_J_HAT:x}=r.TransformedCoordinate,{SWIPE_MIN_DISTANCE:N,SWIPE_EPSILON:A}=r.Swipe;class C extends w{constructor(e,t,s,i){super(e,t,i,s),this.handleDragging=(e,t,s)=>{if(this.moveTween)return;if(this.isMoving)return;const i=t-this.x,r=s-this.y,a=new Phaser.Math.Vector2(i,r);if(a.length()<N)return;const o=a.clone().normalize();if(this.isVertical){const e=x.clone().normalize();if(e.fuzzyEquals(o,A)&&r>0)return void this.moveVertically(!0);if(e.fuzzyEquals(o.scale(-1),A)&&r<0)return void this.moveVertically(!1)}else{const e=_.clone().normalize();if(e.fuzzyEquals(o,A)&&i>0)return void this.moveHorizontally(!0);if(e.fuzzyEquals(o.scale(-1),A)&&i<0)return void this.moveHorizontally(!1)}},this.isMoving=!1,this.createAnimator(),this.initInteractive(),e.add.existing(this),E.push(this)}setMoving(e){this.isMoving=e}setMoveTween(e){this.moveTween=e}createAnimator(){this.animator=new v(this)}initInteractive(){this.setInteractive(),this.scene.input.setDraggable(this),this.createDraggingEventListeners()}createDraggingEventListeners(){this.on(Phaser.Input.Events.DRAG,this.handleDragging),this.on(Phaser.Input.Events.DRAG_END,(()=>{this.moveTween=void 0}))}moveVertically(e){if(!this.isVertical)return;this.exited&&this.removeInteractive();const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.resetOverlapTilesVertical(e,t),this.animator.playVerticalMovingAnimation(e,t)}moveHorizontally(e){if(this.isVertical)return;this.exited&&this.removeInteractive();const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.resetOverlapTilesHorizontal(e,t),this.animator.playHorizontalMovingAnimation(e,t)}executeExit(){super.executeExit(),E.increaseExitedCarNum()}checkCollisionWithBoss(){}}const{Textures:L}=r.Keys;class P extends C{constructor(e,t,s,i=!1){let r;r=s?i?L.Car.Red.NORTH_EAST:L.Car.Red.SOUTH_WEST:i?L.Car.Red.NORTH_WEST:L.Car.Red.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.RED}getWidth(){return 2}getLength(){return 4}changeDirection(e){switch(e){case o.UP:this.setTexture(L.Car.Red.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(L.Car.Red.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(L.Car.Red.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(L.Car.Red.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:H}=r.Keys;class y extends C{constructor(e,t,s,i=!1){let r;r=s?i?H.Car.Blue.NORTH_EAST:H.Car.Blue.SOUTH_WEST:i?H.Car.Blue.NORTH_WEST:H.Car.Blue.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.BLUE}getWidth(){return 2}getLength(){return 5}changeDirection(e){switch(e){case o.UP:this.setTexture(H.Car.Blue.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(H.Car.Blue.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(H.Car.Blue.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(H.Car.Blue.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:I}=r.Keys;class k extends C{constructor(e,t,s,i=!1){let r;r=s?i?I.Car.Green.NORTH_EAST:I.Car.Green.SOUTH_WEST:i?I.Car.Green.NORTH_WEST:I.Car.Green.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.GREEN}getWidth(){return 2}getLength(){return 3}changeDirection(e){switch(e){case o.UP:this.setTexture(I.Car.Green.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(I.Car.Green.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(I.Car.Green.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(I.Car.Green.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:U}=r.Keys;class D extends C{constructor(e,t,s,i=!1){let r;r=s?i?U.Car.Lemon.NORTH_EAST:U.Car.Lemon.SOUTH_WEST:i?U.Car.Lemon.NORTH_WEST:U.Car.Lemon.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.LEMON}getWidth(){return 2}getLength(){return 3}changeDirection(e){switch(e){case o.UP:this.setTexture(U.Car.Lemon.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(U.Car.Lemon.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(U.Car.Lemon.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(U.Car.Lemon.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:W}=r.Keys;class V extends C{constructor(e,t,s,i=!1){let r;r=s?i?W.Car.Orange.NORTH_EAST:W.Car.Orange.SOUTH_WEST:i?W.Car.Orange.NORTH_WEST:W.Car.Orange.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.ORANGE}getWidth(){return 2}getLength(){return 6}changeDirection(e){switch(e){case o.UP:this.setTexture(W.Car.Orange.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(W.Car.Orange.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(W.Car.Orange.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(W.Car.Orange.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:B}=r.Keys;class M extends C{constructor(e,t,s,i=!1){let r;r=s?i?B.Car.Violet.NORTH_EAST:B.Car.Violet.SOUTH_WEST:i?B.Car.Violet.NORTH_WEST:B.Car.Violet.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.VIOLET}getWidth(){return 3}getLength(){return 4}changeDirection(e){switch(e){case o.UP:this.setTexture(B.Car.Violet.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(B.Car.Violet.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(B.Car.Violet.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(B.Car.Violet.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{TILE_SIZE:G,NOT_FIT_BOARD_SCALE:F}=r,z={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{Textures:j}=r.Keys,{TILE:K}=r.Depths;class Y extends Phaser.GameObjects.Image{constructor(e,t,s=j.Tile.UNIT){const i=h(g(t));super(e,i.x,i.y,s),this.setDepth(K),this.boardPosition=t,e.add.existing(this)}}class q{constructor(e){this.scene=e,this.tiles=[]}createTileGrid(){const{rows:e,columns:t}=m.getLevel().boardSize;for(let s=0;s<e;s++)for(let i=0;i<t;i++){const r=new Y(this.scene,{row:s,column:i});this.tiles.push(r),s===Math.floor(e/2)&&i===Math.floor(t/2)&&(this.middleTile=r)}}clearAllTiles(){var e;null===(e=this.tiles)||void 0===e||e.forEach((e=>null==e?void 0:e.destroy())),this.tiles=[]}getAdditionalVector(){const{centerX:e,centerY:t}=this.scene.cameras.main;return new Phaser.Math.Vector2(e-this.middleTile.x,t-this.middleTile.y)}rePositionTilesToCenter(){const e=this.getAdditionalVector();for(const t of this.tiles){const s=new Phaser.Math.Vector2(t.x,t.y);s.add(e),t.setPosition(s.x,s.y)}return e}}const{STATUS:J}=z,{STATUS:X}=z;class $ extends class{constructor(e){this.scene=e}init(){this.setState(J.READY)}start(){this.isRunning()||this.setState(J.RUNNING)}stop(){this.isRunning()&&this.setState(J.STOPPED)}setState(e){this.state=e}isReady(){return this.state===J.READY}isRunning(){return this.state===J.RUNNING}isStopped(){return this.state===J.STOPPED}}{constructor(e){super(e),this.tileGrid=new q(e)}init(){this.clearAllTiles(),super.init()}start(){this.isRunning()||(this.generateBoard(),this.setState(X.RUNNING))}generateBoard(){const{rows:e,columns:t}=m.getLevel().boardSize;this.tileGrid.createTileGrid();for(let s=0;s<e;s++){this.boardArray[s]=[];for(let e=0;e<t;e++)this.boardArray[s][e]=l.EMPTY}}getAdditionalVector(){return this.additionalVector}setTileState(e,t){this.getTileState(e)!==l.NULL&&(this.boardArray[e.row][e.column]=t)}getTileState(e){const{boardSize:t}=m.getLevel();return e.row>=0&&e.row<t.rows&&e.column>=0&&e.column<t.columns?this.boardArray[e.row][e.column]:l.NULL}printBoard(){console.log(this.boardArray)}clearAllTiles(){var e;null===(e=this.tileGrid)||void 0===e||e.clearAllTiles(),this.boardArray=[]}longestEmptySubarrayOnTiles(e){const t=[],s=[];let i=!1;for(let r=0;r<e.length;r++)this.getTileState(e[r])===l.EMPTY?i||(t.push(r),i=!0):i&&(s.push(r-1),i=!1);t.length!=s.length&&s.push(e.length-1);let r=0,a=0;for(let e=0;e<t.length;e++)s[e]-t[e]>=1&&(r=t[e],a=s[e]);return e.slice(r,a+1)}longestEmptyTileSubarrayOnTopSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:0,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnBottomSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:e.rows-1,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnLeftSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:0});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnRightSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:e.columns-1});return this.longestEmptySubarrayOnTiles(t)}}var Z;!function(e){e.BLUE="blue",e.GREEN="green",e.LEMON="lemon",e.ORANGE="orange",e.RED="red",e.VIOLET="violet"}(Z||(Z={}));const Q=Z;var ee;!function(e){e.TRAFFIC_CONE="traffic-corn"}(ee||(ee={}));const te=ee,se=new class{constructor(){this.blockers=[],this.blockersAtExit=[]}push(e,t=!1){this.blockers.push(e),t&&this.blockersAtExit.push(e)}toArray(){return this.blockers}clearAllBlocker(){this.blockers.forEach((e=>null==e?void 0:e.destroy())),this.blockers=[],this.blockersAtExit=[]}deleteBlocker(e){const t=this.blockers.indexOf(e);-1!==t&&this.blockers.splice(t,1),-1!==t&&this.blockersAtExit.splice(t,1)}getBlockersAtExit(){return this.blockersAtExit}};class ie extends Phaser.GameObjects.Image{constructor(e,t,s){const i=h(g(t));super(e,i.x,i.y,s),this.boardPosition=t,this.initDepth(),this.setOverlapTilesState(l.BLOCKER),se.push(this),e.add.existing(this)}initDepth(){const{columns:e}=m.getLevel().boardSize,{row:t,column:s}=this.boardPosition;this.setDepth(e*t+s)}setOverlapTilesState(e){const t=this.scene;null==t||t.getBoardManager().setTileState(this.boardPosition,e)}}const{Blocker:re}=r.Keys.Textures;class ae extends ie{constructor(e,t){const{row:s,column:i}=t,{rows:r,columns:a}=m.getLevel().boardSize;let o,n={x:.5,y:.5};if(s>=1&&s<=r-2&&i>=1&&i<=a-2)switch((s+i)%5){case 0:o=re.BARREL,n={x:.4,y:.75};break;case 1:o=re.HYDRANT,n={x:.4,y:.75};break;case 2:o=re.MAIL_BOX,n={x:.5,y:.7};break;case 3:o=re.PLANT_POT,n={x:.5,y:.75};break;default:o=re.RECYCLE_BIN,n={x:.4,y:.75}}else o=re.TRAFFIC_CONE;super(e,t,o),this.setOrigin(n.x,n.y)}}function oe(e,t){t.cameras.main.fadeOut(500),t.time.addEvent({delay:500,callback:function(){t.cameras.main.fadeIn(500),e()},callbackScope:t})}class ne extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.hasWinPopupShown=!1,this.hasGameOverPopupShown=!1}init(){var e;this.hasWinPopupShown=!1,this.hasGameOverPopupShown=!1,null===(e=this.boardManager)||void 0===e||e.init(),E.clearAllCars(),se.clearAllBlocker()}create(){this.fpsText=new i(this),this.add.text(this.cameras.main.width-15,15,`Phaser v${Phaser.VERSION}`,{color:"#000000",fontSize:"24px"}).setOrigin(1,0),this.boardManager=new $(this),this.boardManager.init(),this.boardManager.start();const{cars:e,blockers:t}=m.getLevel();e.forEach((e=>this.genCar(e))),t.forEach((e=>this.genBlocker(e))),this.initCamera(),this.setControls()}initCamera(){const{rows:e,columns:t}=m.getLevel().boardSize,s=h(g({row:Math.floor(e/2),column:Math.floor(t/2)}));this.cameras.main.centerOn(s.x,s.y),this.cameras.main.zoomTo(function(e){const{rows:t,columns:s}=m.getLevel().boardSize,i=h(g({row:t-1,column:0})),r=h(g({row:0,column:s-1})),a=h(g({row:0,column:0})),o=h(g({row:t-1,column:s-1})),n=Math.abs(r.x-i.x)+G,l=Math.abs(o.y-a.y)+G,c=e.game.config.height,T=e.game.config.width;return c>T?T/n/F:c/l/F}(this))}genCar(e){const t=e.boardPosition,s=e.isVertical,i=Math.random()<.5;let r;switch(e.type){case Q.BLUE:r=new y(this,t,s,i);break;case Q.ORANGE:r=new V(this,t,s,i);break;case Q.RED:r=new P(this,t,s,i);break;case Q.VIOLET:r=new M(this,t,s,i);break;case Q.GREEN:r=new k(this,t,s,i);break;case Q.LEMON:default:r=new D(this,t,s,i)}return r}genBlocker(e){const t=e.boardPosition;let s;return e.type,te.TRAFFIC_CONE,s=new ae(this,t),s}setControls(){const e=this.input.keyboard.createCursorKeys();this.controls=new Phaser.Cameras.Controls.SmoothedKeyControl({camera:this.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,zoomIn:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),zoomOut:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),acceleration:.06,drag:5e-4,maxSpeed:1})}getBoardManager(){return this.boardManager}showWinPopup(){m.isOutOfAutoGeneratedLevels()||this.hasWinPopupShown||(console.log("WIN!!!"),this.hasWinPopupShown=!0,oe((()=>{m.increaseLevelIndex(),this.scene.restart()}),this))}showGameOverPopup(){this.hasGameOverPopupShown||(console.log("GAME OVER :("),this.hasGameOverPopupShown=!0,oe((()=>{this.scene.restart()}),this))}update(e,t){this.fpsText.update(),this.controls.update(t)}}const{Textures:le}=r.Keys;class ce extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image(le.Tile.ONE,"assets/img/Tiles-1-min.png"),this.load.image(le.Tile.TWO,"assets/img/Tiles-2-min.png"),this.load.image(le.Tile.THREE,"assets/img/Tiles-3-min.png"),this.load.image(le.Tile.FOUR,"assets/img/Tiles-4-min.png"),this.load.image(le.Tile.DIRTY,"assets/img/DirtyTile.png"),this.load.image(le.Tile.CLEAN,"assets/img/CleanTile.png"),this.load.image(le.Tile.UNIT,"assets/img/Tiles 5-min.png"),this.load.image(le.Car.Red.NORTH_WEST,"assets/img/new/Red car 1_otp2.png"),this.load.image(le.Car.Red.SOUTH_EAST,"assets/img/new/Red car 2_otp2.png"),this.load.image(le.Car.Red.NORTH_EAST,"assets/img/new/Red car 3_otp2.png"),this.load.image(le.Car.Red.SOUTH_WEST,"assets/img/new/Red car 4_otp2.png"),this.load.image(le.Car.Blue.NORTH_WEST,"assets/img/new/Blue car 3-min.png"),this.load.image(le.Car.Blue.SOUTH_EAST,"assets/img/new/Blue car 4-min.png"),this.load.image(le.Car.Blue.NORTH_EAST,"assets/img/new/Blue car 2-min.png"),this.load.image(le.Car.Blue.SOUTH_WEST,"assets/img/new/Blue car 1-min.png"),this.load.image(le.Car.Green.NORTH_WEST,"assets/img/new/Green car 4-min.png"),this.load.image(le.Car.Green.SOUTH_EAST,"assets/img/new/Green car 3-min.png"),this.load.image(le.Car.Green.NORTH_EAST,"assets/img/new/Green car 1-min.png"),this.load.image(le.Car.Green.SOUTH_WEST,"assets/img/new/Green car 2-min.png"),this.load.image(le.Car.Lemon.NORTH_WEST,"assets/img/new/Lemon car 1-min.png"),this.load.image(le.Car.Lemon.SOUTH_EAST,"assets/img/new/Lemon car 3-min.png"),this.load.image(le.Car.Lemon.NORTH_EAST,"assets/img/new/Lemon car 2-min.png"),this.load.image(le.Car.Lemon.SOUTH_WEST,"assets/img/new/Lemon car 4-min.png"),this.load.image(le.Car.Orange.NORTH_WEST,"assets/img/new/Or car 1-min.png"),this.load.image(le.Car.Orange.SOUTH_EAST,"assets/img/new/Or car 2-min.png"),this.load.image(le.Car.Orange.NORTH_EAST,"assets/img/new/Or car 3-min.png"),this.load.image(le.Car.Orange.SOUTH_WEST,"assets/img/new/Or car 4-min.png"),this.load.image(le.Car.Violet.NORTH_WEST,"assets/img/new/Violet car 2-min.png"),this.load.image(le.Car.Violet.SOUTH_EAST,"assets/img/new/Violet car 3-min.png"),this.load.image(le.Car.Violet.NORTH_EAST,"assets/img/new/Violet car 1-min.png"),this.load.image(le.Car.Violet.SOUTH_WEST,"assets/img/new/Violet car 4-min.png"),this.load.image(le.Blocker.BARREL,"assets/img/blockers/barrel.png"),this.load.image(le.Blocker.HYDRANT,"assets/img/blockers/hydrant.png"),this.load.image(le.Blocker.MAIL_BOX,"assets/img/blockers/mail-box.png"),this.load.image(le.Blocker.PLANT_POT,"assets/img/blockers/plant-pot.png"),this.load.image(le.Blocker.RECYCLE_BIN,"assets/img/blockers/recycle-bin.png"),this.load.image(le.Blocker.TRAFFIC_CONE,"assets/img/blockers/traffic-cone.png"),this.load.json("level0","assets/levels/level_0.json"),this.load.json("level1","assets/levels/level_1.json"),this.load.json("level2","assets/levels/level_2.json"),this.load.json("big_level1","assets/levels/big_level1.json"),this.load.json("big_level2","assets/levels/big_level2.json"),this.load.json("big_level3","assets/levels/big_level3.json")}create(){this.scene.start("MainScene");const e=this.cache.json.get("level0"),t=this.cache.json.get("level1"),s=this.cache.json.get("level2"),i=this.cache.json.get("big_level1"),r=this.cache.json.get("big_level2"),a=this.cache.json.get("big_level3");m.addLevel(e),m.addLevel(t),m.addLevel(s),m.addLevel(i),m.addLevel(r),m.addLevel(a),m.setLevelIndex(0)}}const he={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:960,height:1554},scene:[ce,ne]};window.addEventListener("load",(()=>{new Phaser.Game(he)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,r,a)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,r,a]=e[h],n=!0,l=0;l<s.length;l++)(!1&a||o>=a)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(n=!1,a<o&&(o=a));if(n){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,r,a]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,a,[o,n,l]=s,c=0;if(o.some((t=>0!==e[t]))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(l)var h=l(i)}for(t&&t(s);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(214)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();