/*! For license information please see main.c53e43f629438435bbc0.bundle.js.LICENSE.txt */
(()=>{var e,t={403:(e,t,s)=>{"use strict";s(260);class i extends Phaser.GameObjects.Text{constructor(e){super(e,10,10,"",{color:"black",fontSize:"28px"}),e.add.existing(this),this.setOrigin(0)}update(){this.setText(`fps: ${Math.floor(this.scene.game.loop.actualFps)}`)}}const r={Depths:{TILE:0},TILE_SIZE:85,NOT_FIT_BOARD_SCALE:1.1,Keys:{Textures:{Car:{Red:{NORTH_WEST:"north-west-red",NORTH_EAST:"north-east-red",SOUTH_WEST:"south-west-red",SOUTH_EAST:"south-east-red"},Blue:{NORTH_WEST:"north-west-blue",NORTH_EAST:"north-east-blue",SOUTH_WEST:"south-west-blue",SOUTH_EAST:"south-east-blue"},Green:{NORTH_WEST:"north-west-green",NORTH_EAST:"north-east-green",SOUTH_WEST:"south-west-green",SOUTH_EAST:"south-east-green"},Lemon:{NORTH_WEST:"north-west-lemon",NORTH_EAST:"north-east-lemon",SOUTH_WEST:"south-west-lemon",SOUTH_EAST:"south-east-lemon"},Orange:{NORTH_WEST:"north-west-orange",NORTH_EAST:"north-east-orange",SOUTH_WEST:"south-west-orange",SOUTH_EAST:"south-east-orange"},Violet:{NORTH_WEST:"north-west-violet",NORTH_EAST:"north-east-violet",SOUTH_WEST:"south-west-violet",SOUTH_EAST:"south-east-violet"}},Blocker:{BARREL:"barrel",HYDRANT:"hydrant",MAIL_BOX:"mail-box",PLANT_POT:"plant-pot",RECYCLE_BIN:"recycle-bin",TRAFFIC_CONE:"traffic-cone"},Wall:{Left:{SHORT:"short-left-wall",MEDIUM:"medium-left-wall",LONG:"long-left-wall"},Right:{SHORT:"short-right-wall",MEDIUM:"medium-right-wall",LONG:"long-right-wall"},Top:{SHORT:"short-top-wall",MEDIUM:"medium-top-wall",LONG:"long-top-wall"},Bottom:{SHORT:"short-bottom-wall",MEDIUM:"medium-bottom-wall",LONG:"long-bottom-wall"}},Tile:{ONE:"tile-1",TWO:"tile-2",THREE:"tile-3",FOUR:"tile-4",DIRTY:"dirty-tile",CLEAN:"clean-tile",UNIT:"unit-tile"}}},TransformedCoordinate:{TRANSFORMED_I_HAT:new Phaser.Math.Vector2(39.5,19),TRANSFORMED_J_HAT:new Phaser.Math.Vector2(-22.5,34)},ANCHOR_POSITION:new Phaser.Math.Vector2(440,80),TWEEN_SPEED:60,Swipe:{SWIPE_MIN_DISTANCE:50,SWIPE_EPSILON:.5}};var a;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(a||(a={}));const o=a;var n;!function(e){e[e.NULL=-1]="NULL",e[e.EMPTY=0]="EMPTY",e[e.GREEN=1]="GREEN",e[e.LEMON=2]="LEMON",e[e.ORANGE=3]="ORANGE",e[e.RED=4]="RED",e[e.BLUE=5]="BLUE",e[e.VIOLET=6]="VIOLET",e[e.BLOCKER=7]="BLOCKER",e[e.GRANDMA=8]="GRANDMA"}(n||(n={}));const l=n,{ANCHOR_POSITION:c}=r;function h(e){return e.clone().add(c)}const{TRANSFORMED_I_HAT:T,TRANSFORMED_J_HAT:g}=r.TransformedCoordinate;function u(e){return new Phaser.Math.Vector2(e.row*g.x+e.column*T.x,e.row*g.y+e.column*T.y)}const d=new class{constructor(){this.levelIndex=0,this.levelConfigs=[]}addLevel(e){this.levelConfigs.push(e)}getLevel(){return this.levelConfigs[this.levelIndex]}getLevelIndex(){return this.levelIndex}setLevelIndex(e){e>=this.levelConfigs.length?this.levelIndex=0:this.levelIndex=e}increaseLevelIndex(e=1){this.setLevelIndex(this.levelIndex+e)}getMaxLevelIndex(){return this.levelConfigs.length-1}getLevelConfigsLength(){return this.levelConfigs.length}isOutOfAutoGeneratedLevels(){return this.levelIndex===this.levelConfigs.length-1}},m=d,E=new class{constructor(){this.cars=[],this.exitedCarNum=0}push(e){this.cars.push(e)}didAllCarExit(){return this.exitedCarNum===this.cars.length&&this.cars.length>0}toArray(){return this.cars}clearAllCars(){this.cars.forEach((e=>null==e?void 0:e.destroy())),this.cars=[],this.exitedCarNum=0}increaseExitedCarNum(){console.log("exit"),this.exitedCarNum++,console.log(this.exitedCarNum),console.log(this.cars.length)}};function O(e,t){return Math.abs(e.row-t.row)+Math.abs(e.column-t.column)}const{TRANSFORMED_I_HAT:S,TRANSFORMED_J_HAT:p}=r.TransformedCoordinate,{ANCHOR_POSITION:R}=r,{TRANSFORMED_I_HAT:w,TRANSFORMED_J_HAT:b}=r.TransformedCoordinate,{TWEEN_SPEED:f}=r;class v{constructor(e){this.car=e,this.scene=this.car.scene}playVerticalMovingAnimation(e,t){this.car.getIsVertical()&&(this.car.didExit()&&(t+=this.car.getLength()),this.playMovingAnimation(b.clone(),e,t,e?o.DOWN:o.UP))}playHorizontalMovingAnimation(e,t){this.car.getIsVertical()||(this.car.didExit()&&(t+=this.car.getLength()),this.playMovingAnimation(w.clone(),e,t,e?o.RIGHT:o.LEFT))}playMovingAnimation(e,t,s,i){this.car.setMoving(!0);const r=new Phaser.Math.Vector2(this.car.x,this.car.y),a=t?s:-s,o=e.scale(a),n=r.add(o),{rows:l,columns:c}=m.getLevel().boardSize;let h=this.car.boardPosition;const T=this.scene.add.tween({targets:this.car,x:n.x,y:n.y,duration:f*s,ease:Phaser.Math.Easing.Sine.InOut,onUpdate:()=>{const e=function(e){const t=e.clone().subtract(R),{x:s,y:i}=p,{x:r,y:a}=S,o=1/(s*a-r*i),n=new Phaser.Math.Vector2(a,-i),l=new Phaser.Math.Vector2(-r,s),c=t.x*n.x+t.y*l.x,h=t.x*n.y+t.y*l.y;return{row:Math.floor(c*o),column:Math.floor(h*o)}}(new Phaser.Math.Vector2(this.car.x,this.car.y));e.row<0||e.row>=l||e.column<0||e.column>=c||e.row==h.row&&e.column==h.column||(h=e,this.car.setDepth(c*e.row+e.column))},onComplete:()=>{this.car.setMoving(!1),this.car.didExit()?this.playExitAnimation(i):this.car.initDepth()}});this.car.setMoveTween(T)}playExitAnimation(e){const{topRight:t,bottomLeft:s,bottomRight:i,goal:r}=this.getBoardCornersAndGoal(),a=this.scene.tweens.createTimeline();switch(e){case o.UP:{this.car.changeDirection(o.RIGHT);const e=Math.abs(t.column-this.car.boardPosition.column);this.addPositionToTimeline(a,t,o.DOWN,e);const n=O(i,t);this.addPositionToTimeline(a,i,o.LEFT,n);const l=O(s,i);this.addPositionToTimeline(a,s,o.UP,l);const c=O(r,s);this.addPositionToTimeline(a,r,o.UP,c);break}case o.DOWN:{this.car.changeDirection(o.LEFT);const e=Math.abs(s.column-this.car.boardPosition.column);this.addPositionToTimeline(a,s,o.UP,e);const t=O(r,s);this.addPositionToTimeline(a,r,o.UP,t);break}case o.LEFT:{this.car.changeDirection(o.UP);const e=Math.abs(r.row-this.car.boardPosition.row);this.addPositionToTimeline(a,r,o.UP,e);break}case o.RIGHT:{this.car.changeDirection(o.DOWN);const e=Math.abs(i.row-this.car.boardPosition.row);this.addPositionToTimeline(a,i,o.LEFT,e);const t=O(s,i);this.addPositionToTimeline(a,s,o.UP,t);const n=O(r,s);this.addPositionToTimeline(a,r,o.UP,n);break}default:console.log("Invalid direction")}this.playDisappearAnimation(a),a.play()}addPositionToTimeline(e,t,s,i){const r=h(u(t));e.add({targets:this.car,ease:Phaser.Math.Easing.Sine.InOut,duration:f*i,x:r.x,y:r.y,onComplete:()=>{this.car.boardPosition.row=t.row,this.car.boardPosition.column=t.column,this.car.changeDirection(s)}})}playDisappearAnimation(e){e.add({targets:this.car,alpha:0,duration:500,ease:Phaser.Math.Easing.Sine.InOut,onComplete:()=>{E.didAllCarExit()&&this.scene.showWinPopup()}})}getBoardCornersAndGoal(){const{rows:e,columns:t}=m.getLevel().boardSize,s=Math.ceil(this.car.getLength()/2);return{topLeft:{row:0-s,column:0-s},topRight:{row:0-s,column:t-1+s},bottomLeft:{row:e-1+s,column:0-s},bottomRight:{row:e-1+s,column:t-1+s},goal:{row:-5,column:0-s}}}}const _=[l.BLUE,l.GREEN,l.LEMON,l.ORANGE,l.RED,l.VIOLET];_.push(l.BLOCKER);const A=_;class x extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,i),this.boardPosition=t,this.isVertical=s,this.exited=!1,this.initWorldPosition(),this.initRotation(),this.initDepth(),this.setOverlapTilesState(this.getTileState()),e.add.existing(this)}didExit(){return this.exited}getBoardPosition(){return this.boardPosition}getIsVertical(){return this.isVertical}initWorldPosition(){const e=h(function(e,t,s,i){let r=0,a=0;return i?(r=(s-2)/2+1/4,a=(t-1)/2):(a=(s-1)/2-1/4,r=(t-1)/2-1/4),u({row:e.row+r,column:e.column+a})}(this.boardPosition,this.getWidth(),this.getLength(),this.isVertical));this.x=e.x,this.y=e.y}initRotation(){this.angle=this.isVertical?-60:30}initDepth(){const{columns:e}=m.getLevel().boardSize;this.setDepth(e*this.boardPosition.row+this.boardPosition.column)}canTileBlockRectangle(e){return A.includes(e)}moveHorizontally(e){const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.resetOverlapTilesHorizontal(e,t)}moveVertically(e){const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.resetOverlapTilesVertical(e,t)}computeTravelingBoardDistanceRight(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene,t=this.getFrontTiles(),s=t[0].column;let i=s;for(;;){i++;let s=!1,r=!1;for(const a of t){const t={row:a.row,column:i},o=e.getBoardManager().getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceLeft(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getRearTiles(),s=t[0].column;let i=s;for(;;){i--;let s=!1,r=!1;for(const a of t){const t={row:a.row,column:i},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}computeTravelingBoardDistanceDown(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getFrontTiles(),s=t[0].row;let i=s;for(;;){i++;let s=!1,r=!1;for(const a of t){const t={row:i,column:a.column},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceUp(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene.getBoardManager(),t=this.getRearTiles(),s=t[0].row;let i=s;for(;;){i--;let s=!1,r=!1;for(const a of t){const t={row:i,column:a.column},o=e.getTileState(t);if(this.canTileBlockRectangle(o)){s=!0,r=!1;break}r=o===l.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}setOverlapTilesState(e){const t=this.scene;this.getOverlapTiles().forEach((s=>{t.getBoardManager().getTileState(s)!==l.NULL?t.getBoardManager().setTileState(s,e):console.log(`${s.row} ${s.column} is null`)}))}resetOverlapTilesVertical(e,t){this.setOverlapTilesState(l.EMPTY),this.exited||(e?this.boardPosition.row+=t:this.boardPosition.row-=t,this.setOverlapTilesState(this.getTileState()))}resetOverlapTilesHorizontal(e,t){this.setOverlapTilesState(l.EMPTY),this.exited||(e?this.boardPosition.column+=t:this.boardPosition.column-=t,this.setOverlapTilesState(this.getTileState()))}getRearTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getWidth();t++){const s={row:this.boardPosition.row,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++){const s={row:t,column:this.boardPosition.column};e.push(s)}return e}getFrontTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getWidth();t++){const s={row:this.boardPosition.row+this.getLength()-1,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++){const s={row:t,column:this.boardPosition.column+this.getLength()-1};e.push(s)}return e}getOverlapTiles(){const e=[];if(this.isVertical)for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getLength();t++)for(let s=this.boardPosition.column;s<this.boardPosition.column+this.getWidth();s++){const i={row:t,column:s};e.push(i)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getWidth();t++)for(let s=this.boardPosition.column;s<this.boardPosition.column+this.getLength();s++){const i={row:t,column:s};e.push(i)}return e}executeExit(){this.exited=!0}}const{TRANSFORMED_I_HAT:L,TRANSFORMED_J_HAT:N}=r.TransformedCoordinate,{SWIPE_MIN_DISTANCE:C,SWIPE_EPSILON:H}=r.Swipe;class P extends x{constructor(e,t,s,i){super(e,t,i,s),this.handleDragging=(e,t,s)=>{if(this.moveTween)return;if(this.isMoving)return;const i=t-this.x,r=s-this.y,a=new Phaser.Math.Vector2(i,r);if(a.length()<C)return;const o=a.clone().normalize();if(this.isVertical){const e=N.clone().normalize();if(e.fuzzyEquals(o,H)&&r>0)return void this.moveVertically(!0);if(e.fuzzyEquals(o.scale(-1),H)&&r<0)return void this.moveVertically(!1)}else{const e=L.clone().normalize();if(e.fuzzyEquals(o,H)&&i>0)return void this.moveHorizontally(!0);if(e.fuzzyEquals(o.scale(-1),H)&&i<0)return void this.moveHorizontally(!1)}},this.isMoving=!1,this.createAnimator(),this.initInteractive(),e.add.existing(this),E.push(this)}setMoving(e){this.isMoving=e}setMoveTween(e){this.moveTween=e}createAnimator(){this.animator=new v(this)}initInteractive(){this.setInteractive(),this.scene.input.setDraggable(this),this.createDraggingEventListeners()}createDraggingEventListeners(){this.on(Phaser.Input.Events.DRAG,this.handleDragging),this.on(Phaser.Input.Events.DRAG_END,(()=>{this.moveTween=void 0}))}moveVertically(e){if(!this.isVertical)return;this.exited&&this.removeInteractive();const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.resetOverlapTilesVertical(e,t),this.animator.playVerticalMovingAnimation(e,t)}moveHorizontally(e){if(this.isVertical)return;this.exited&&this.removeInteractive();const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.resetOverlapTilesHorizontal(e,t),this.animator.playHorizontalMovingAnimation(e,t)}executeExit(){super.executeExit(),E.increaseExitedCarNum()}checkCollisionWithBoss(){}}const{Textures:y}=r.Keys;class I extends P{constructor(e,t,s,i=!1){let r;r=s?i?y.Car.Red.NORTH_EAST:y.Car.Red.SOUTH_WEST:i?y.Car.Red.NORTH_WEST:y.Car.Red.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.RED}getWidth(){return 2}getLength(){return 4}changeDirection(e){switch(e){case o.UP:this.setTexture(y.Car.Red.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(y.Car.Red.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(y.Car.Red.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(y.Car.Red.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:k}=r.Keys;class B extends P{constructor(e,t,s,i=!1){let r;r=s?i?k.Car.Blue.NORTH_EAST:k.Car.Blue.SOUTH_WEST:i?k.Car.Blue.NORTH_WEST:k.Car.Blue.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.BLUE}getWidth(){return 2}getLength(){return 5}changeDirection(e){switch(e){case o.UP:this.setTexture(k.Car.Blue.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(k.Car.Blue.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(k.Car.Blue.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(k.Car.Blue.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:W}=r.Keys;class D extends P{constructor(e,t,s,i=!1){let r;r=s?i?W.Car.Green.NORTH_EAST:W.Car.Green.SOUTH_WEST:i?W.Car.Green.NORTH_WEST:W.Car.Green.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.GREEN}getWidth(){return 2}getLength(){return 3}changeDirection(e){switch(e){case o.UP:this.setTexture(W.Car.Green.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(W.Car.Green.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(W.Car.Green.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(W.Car.Green.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:M}=r.Keys;class U extends P{constructor(e,t,s,i=!1){let r;r=s?i?M.Car.Lemon.NORTH_EAST:M.Car.Lemon.SOUTH_WEST:i?M.Car.Lemon.NORTH_WEST:M.Car.Lemon.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.LEMON}getWidth(){return 2}getLength(){return 3}changeDirection(e){switch(e){case o.UP:this.setTexture(M.Car.Lemon.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(M.Car.Lemon.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(M.Car.Lemon.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(M.Car.Lemon.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:V}=r.Keys;class G extends P{constructor(e,t,s,i=!1){let r;r=s?i?V.Car.Orange.NORTH_EAST:V.Car.Orange.SOUTH_WEST:i?V.Car.Orange.NORTH_WEST:V.Car.Orange.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.ORANGE}getWidth(){return 2}getLength(){return 6}changeDirection(e){switch(e){case o.UP:this.setTexture(V.Car.Orange.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(V.Car.Orange.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(V.Car.Orange.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(V.Car.Orange.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{Textures:F}=r.Keys;class z extends P{constructor(e,t,s,i=!1){let r;r=s?i?F.Car.Violet.NORTH_EAST:F.Car.Violet.SOUTH_WEST:i?F.Car.Violet.NORTH_WEST:F.Car.Violet.SOUTH_EAST,super(e,t,r,s)}getTileState(){return l.VIOLET}getWidth(){return 3}getLength(){return 4}changeDirection(e){switch(e){case o.UP:this.setTexture(F.Car.Violet.NORTH_EAST),this.isVertical=!0;break;case o.DOWN:this.setTexture(F.Car.Violet.SOUTH_WEST),this.isVertical=!0;break;case o.LEFT:this.setTexture(F.Car.Violet.NORTH_WEST),this.isVertical=!1;break;case o.RIGHT:default:this.setTexture(F.Car.Violet.SOUTH_EAST),this.isVertical=!1}this.initRotation()}}const{TILE_SIZE:j,NOT_FIT_BOARD_SCALE:K}=r,Y={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{Textures:X}=r.Keys,{TILE:J}=r.Depths;class q extends Phaser.GameObjects.Image{constructor(e,t,s=X.Tile.UNIT){const i=h(u(t));super(e,i.x,i.y,s),this.setDepth(J),this.boardPosition=t,e.add.existing(this)}}class ${constructor(e){this.scene=e,this.tiles=[]}createTileGrid(){const{rows:e,columns:t}=m.getLevel().boardSize;for(let s=0;s<e;s++)for(let i=0;i<t;i++){const r=new q(this.scene,{row:s,column:i});this.tiles.push(r),s===Math.floor(e/2)&&i===Math.floor(t/2)&&(this.middleTile=r)}}clearAllTiles(){var e;null===(e=this.tiles)||void 0===e||e.forEach((e=>null==e?void 0:e.destroy())),this.tiles=[]}getAdditionalVector(){const{centerX:e,centerY:t}=this.scene.cameras.main;return new Phaser.Math.Vector2(e-this.middleTile.x,t-this.middleTile.y)}rePositionTilesToCenter(){const e=this.getAdditionalVector();for(const t of this.tiles){const s=new Phaser.Math.Vector2(t.x,t.y);s.add(e),t.setPosition(s.x,s.y)}return e}}const{STATUS:Z}=Y,{STATUS:Q}=Y;class ee extends class{constructor(e){this.scene=e}init(){this.setState(Z.READY)}start(){this.isRunning()||this.setState(Z.RUNNING)}stop(){this.isRunning()&&this.setState(Z.STOPPED)}setState(e){this.state=e}isReady(){return this.state===Z.READY}isRunning(){return this.state===Z.RUNNING}isStopped(){return this.state===Z.STOPPED}}{constructor(e){super(e),this.tileGrid=new $(e)}init(){this.clearAllTiles(),super.init()}start(){this.isRunning()||(this.generateBoard(),this.setState(Q.RUNNING))}generateBoard(){const{rows:e,columns:t}=m.getLevel().boardSize;this.tileGrid.createTileGrid();for(let s=0;s<e;s++){this.boardArray[s]=[];for(let e=0;e<t;e++)this.boardArray[s][e]=l.EMPTY}}getAdditionalVector(){return this.additionalVector}setTileState(e,t){this.getTileState(e)!==l.NULL&&(this.boardArray[e.row][e.column]=t)}getTileState(e){const{boardSize:t}=m.getLevel();return e.row>=0&&e.row<t.rows&&e.column>=0&&e.column<t.columns?this.boardArray[e.row][e.column]:l.NULL}printBoard(){console.log(this.boardArray)}clearAllTiles(){var e;null===(e=this.tileGrid)||void 0===e||e.clearAllTiles(),this.boardArray=[]}longestEmptySubarrayOnTiles(e){const t=[],s=[];let i=!1;for(let r=0;r<e.length;r++)this.getTileState(e[r])===l.EMPTY?i||(t.push(r),i=!0):i&&(s.push(r-1),i=!1);t.length!=s.length&&s.push(e.length-1);let r=0,a=0;for(let e=0;e<t.length;e++)s[e]-t[e]>=1&&(r=t[e],a=s[e]);return e.slice(r,a+1)}longestEmptyTileSubarrayOnTopSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:0,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnBottomSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:e.rows-1,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnLeftSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:0});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnRightSide(){const{boardSize:e}=m.getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:e.columns-1});return this.longestEmptySubarrayOnTiles(t)}}var te;!function(e){e.BLUE="blue",e.GREEN="green",e.LEMON="lemon",e.ORANGE="orange",e.RED="red",e.VIOLET="violet"}(te||(te={}));const se=te,ie=new class{constructor(){this.blockers=[],this.blockersAtExit=[]}push(e,t=!1){this.blockers.push(e),t&&this.blockersAtExit.push(e)}toArray(){return this.blockers}clearAllBlocker(){this.blockers.forEach((e=>null==e?void 0:e.destroy())),this.blockers=[],this.blockersAtExit=[]}deleteBlocker(e){const t=this.blockers.indexOf(e);-1!==t&&this.blockers.splice(t,1),-1!==t&&this.blockersAtExit.splice(t,1)}getBlockersAtExit(){return this.blockersAtExit}};class re extends Phaser.GameObjects.Image{constructor(e,t,s){const i=h(u(t));super(e,i.x,i.y,s),this.boardPosition=t,this.initDepth(),this.setOverlapTilesState(l.BLOCKER),ie.push(this),e.add.existing(this)}initDepth(){const{columns:e}=m.getLevel().boardSize,{row:t,column:s}=this.boardPosition;this.setDepth(e*t+s)}setOverlapTilesState(e){const t=this.scene;null==t||t.getBoardManager().setTileState(this.boardPosition,e)}}const{Blocker:ae}=r.Keys.Textures;class oe extends re{constructor(e,t){super(e,t,ae.TRAFFIC_CONE),this.setOrigin(.5,.5)}}function ne(e,t){t.cameras.main.fadeOut(500),t.time.addEvent({delay:500,callback:function(){t.cameras.main.fadeIn(500),e()},callbackScope:t})}const{Blocker:le}=r.Keys.Textures;class ce extends re{constructor(e,t){super(e,t,le.BARREL),this.setOrigin(.4,.75)}}const{Blocker:he}=r.Keys.Textures;class Te extends re{constructor(e,t){super(e,t,he.HYDRANT),this.setOrigin(.4,.75)}}const{Blocker:ge}=r.Keys.Textures;class ue extends re{constructor(e,t){super(e,t,ge.MAIL_BOX),this.setOrigin(.5,.7)}}const{Blocker:de}=r.Keys.Textures;class me extends re{constructor(e,t){super(e,t,de.PLANT_POT),this.setOrigin(.5,.75)}}const{Blocker:Ee}=r.Keys.Textures;class Oe extends re{constructor(e,t){super(e,t,Ee.RECYCLE_BIN),this.setOrigin(.4,.75)}}var Se;!function(e){e.TRAFFIC_CONE="traffic-cone",e.BARREL="barrel",e.HYDRANT="hydrant",e.MAIL_BOX="mail-box",e.PLANT_POT="plant-pot",e.RECYCLE_BIN="recycle-bin",e.SHORT_WALL="short-wall"}(Se||(Se={}));const pe=Se,{Wall:Re}=r.Keys.Textures;class we extends re{constructor(e,t){const{row:s,column:i}=t,{rows:r}=m.getLevel().boardSize;let a,o={x:.5,y:.5};0===s?(a=Re.Top.SHORT,o={x:.3,y:.9}):s===r-1?(a=Re.Bottom.SHORT,o={x:.6,y:.5}):0===i?(a=Re.Left.SHORT,o={x:.85,y:.75}):(a=Re.Right.SHORT,o={x:.15,y:.55}),super(e,t,a),this.setOrigin(o.x,o.y)}}class be extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.hasWinPopupShown=!1,this.hasGameOverPopupShown=!1}init(){var e;this.hasWinPopupShown=!1,this.hasGameOverPopupShown=!1,null===(e=this.boardManager)||void 0===e||e.init(),E.clearAllCars(),ie.clearAllBlocker()}create(){this.fpsText=new i(this),this.add.text(this.cameras.main.width-15,15,`Phaser v${Phaser.VERSION}`,{color:"#000000",fontSize:"24px"}).setOrigin(1,0),this.boardManager=new ee(this),this.boardManager.init(),this.boardManager.start();const{cars:e,blockers:t}=m.getLevel();e.forEach((e=>this.genCar(e))),t.forEach((e=>this.genBlocker(e))),this.initCamera(),this.setControls(),this.boardManager.printBoard()}initCamera(){const{rows:e,columns:t}=m.getLevel().boardSize,s=h(u({row:Math.floor(e/2),column:Math.floor(t/2)}));this.cameras.main.centerOn(s.x,s.y),this.cameras.main.zoomTo(function(e){const{rows:t,columns:s}=m.getLevel().boardSize,i=h(u({row:t-1,column:0})),r=h(u({row:0,column:s-1})),a=h(u({row:0,column:0})),o=h(u({row:t-1,column:s-1})),n=Math.abs(r.x-i.x)+j,l=Math.abs(o.y-a.y)+j,c=e.game.config.height,T=e.game.config.width;return c>T?T/n/K:c/l/K}(this))}genCar(e){const t=e.boardPosition,s=e.isVertical,i=Math.random()<.5;let r;switch(e.type){case se.BLUE:r=new B(this,t,s,i);break;case se.ORANGE:r=new G(this,t,s,i);break;case se.RED:r=new I(this,t,s,i);break;case se.VIOLET:r=new z(this,t,s,i);break;case se.GREEN:r=new D(this,t,s,i);break;case se.LEMON:default:r=new U(this,t,s,i)}return r}genBlocker(e){const{boardPosition:t}=e,s=function(e){const{row:t,column:s}=e,{rows:i,columns:r}=m.getLevel().boardSize;let a;if(t>=1&&t<=i-2&&s>=1&&s<=r-2)switch((t+s)%6){case 0:a=pe.BARREL;break;case 1:a=pe.HYDRANT;break;case 2:a=pe.MAIL_BOX;break;case 3:a=pe.PLANT_POT;break;case 4:a=pe.RECYCLE_BIN;break;default:a=pe.TRAFFIC_CONE}else a=pe.SHORT_WALL;return a}(t);let i;switch(s){case pe.BARREL:i=new ce(this,t);break;case pe.HYDRANT:i=new Te(this,t);break;case pe.MAIL_BOX:i=new ue(this,t);break;case pe.PLANT_POT:i=new me(this,t);break;case pe.RECYCLE_BIN:i=new Oe(this,t);break;case pe.TRAFFIC_CONE:i=new oe(this,t);break;case pe.SHORT_WALL:default:i=new we(this,t)}return i}setControls(){const e=this.input.keyboard.createCursorKeys();this.controls=new Phaser.Cameras.Controls.SmoothedKeyControl({camera:this.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,zoomIn:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),zoomOut:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),acceleration:.06,drag:5e-4,maxSpeed:1})}getBoardManager(){return this.boardManager}showWinPopup(){m.isOutOfAutoGeneratedLevels()||this.hasWinPopupShown||(console.log("WIN!!!"),this.hasWinPopupShown=!0,ne((()=>{m.increaseLevelIndex(),this.scene.restart()}),this))}showGameOverPopup(){this.hasGameOverPopupShown||(console.log("GAME OVER :("),this.hasGameOverPopupShown=!0,ne((()=>{this.scene.restart()}),this))}update(e,t){this.fpsText.update(),this.controls.update(t)}}const{Textures:fe}=r.Keys;class ve extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image(fe.Tile.ONE,"assets/img/Tiles-1-min.png"),this.load.image(fe.Tile.TWO,"assets/img/Tiles-2-min.png"),this.load.image(fe.Tile.THREE,"assets/img/Tiles-3-min.png"),this.load.image(fe.Tile.FOUR,"assets/img/Tiles-4-min.png"),this.load.image(fe.Tile.DIRTY,"assets/img/DirtyTile.png"),this.load.image(fe.Tile.CLEAN,"assets/img/CleanTile.png"),this.load.image(fe.Tile.UNIT,"assets/img/Tiles 5-min.png"),this.load.image(fe.Car.Red.NORTH_WEST,"assets/img/new/Red car 1_otp2.png"),this.load.image(fe.Car.Red.SOUTH_EAST,"assets/img/new/Red car 2_otp2.png"),this.load.image(fe.Car.Red.NORTH_EAST,"assets/img/new/Red car 3_otp2.png"),this.load.image(fe.Car.Red.SOUTH_WEST,"assets/img/new/Red car 4_otp2.png"),this.load.image(fe.Car.Blue.NORTH_WEST,"assets/img/new/Blue car 3-min.png"),this.load.image(fe.Car.Blue.SOUTH_EAST,"assets/img/new/Blue car 4-min.png"),this.load.image(fe.Car.Blue.NORTH_EAST,"assets/img/new/Blue car 2-min.png"),this.load.image(fe.Car.Blue.SOUTH_WEST,"assets/img/new/Blue car 1-min.png"),this.load.image(fe.Car.Green.NORTH_WEST,"assets/img/new/Green car 4-min.png"),this.load.image(fe.Car.Green.SOUTH_EAST,"assets/img/new/Green car 3-min.png"),this.load.image(fe.Car.Green.NORTH_EAST,"assets/img/new/Green car 1-min.png"),this.load.image(fe.Car.Green.SOUTH_WEST,"assets/img/new/Green car 2-min.png"),this.load.image(fe.Car.Lemon.NORTH_WEST,"assets/img/new/Lemon car 1-min.png"),this.load.image(fe.Car.Lemon.SOUTH_EAST,"assets/img/new/Lemon car 3-min.png"),this.load.image(fe.Car.Lemon.NORTH_EAST,"assets/img/new/Lemon car 2-min.png"),this.load.image(fe.Car.Lemon.SOUTH_WEST,"assets/img/new/Lemon car 4-min.png"),this.load.image(fe.Car.Orange.NORTH_WEST,"assets/img/new/Or car 1-min.png"),this.load.image(fe.Car.Orange.SOUTH_EAST,"assets/img/new/Or car 2-min.png"),this.load.image(fe.Car.Orange.NORTH_EAST,"assets/img/new/Or car 3-min.png"),this.load.image(fe.Car.Orange.SOUTH_WEST,"assets/img/new/Or car 4-min.png"),this.load.image(fe.Car.Violet.NORTH_WEST,"assets/img/new/Violet car 2-min.png"),this.load.image(fe.Car.Violet.SOUTH_EAST,"assets/img/new/Violet car 3-min.png"),this.load.image(fe.Car.Violet.NORTH_EAST,"assets/img/new/Violet car 1-min.png"),this.load.image(fe.Car.Violet.SOUTH_WEST,"assets/img/new/Violet car 4-min.png"),this.load.image(fe.Blocker.BARREL,"assets/img/blockers/barrel.png"),this.load.image(fe.Blocker.HYDRANT,"assets/img/blockers/hydrant.png"),this.load.image(fe.Blocker.MAIL_BOX,"assets/img/blockers/mail-box.png"),this.load.image(fe.Blocker.PLANT_POT,"assets/img/blockers/plant-pot.png"),this.load.image(fe.Blocker.RECYCLE_BIN,"assets/img/blockers/recycle-bin.png"),this.load.image(fe.Blocker.TRAFFIC_CONE,"assets/img/blockers/traffic-cone.png"),this.load.image(fe.Wall.Top.SHORT,"assets/img/concrete-walls/Vat can A1-min.png"),this.load.image(fe.Wall.Top.SHORT,"assets/img/concrete-walls/Vat can A2-min.png"),this.load.image(fe.Wall.Top.SHORT,"assets/img/concrete-walls/Vat can A3-min.png"),this.load.image(fe.Wall.Left.SHORT,"assets/img/concrete-walls/Vat can B1-min.png"),this.load.image(fe.Wall.Left.SHORT,"assets/img/concrete-walls/Vat can B2-min.png"),this.load.image(fe.Wall.Bottom.SHORT,"assets/img/concrete-walls/Vat can C1-min.png"),this.load.image(fe.Wall.Bottom.SHORT,"assets/img/concrete-walls/Vat can C2-min.png"),this.load.image(fe.Wall.Bottom.SHORT,"assets/img/concrete-walls/Vat can C3-min.png"),this.load.image(fe.Wall.Right.SHORT,"assets/img/concrete-walls/Vat can D1-min.png"),this.load.image(fe.Wall.Right.SHORT,"assets/img/concrete-walls/Vat can D2-min.png"),this.load.image(fe.Wall.Right.SHORT,"assets/img/concrete-walls/Vat can D3-min.png"),this.load.json("level0","assets/levels/level_0.json"),this.load.json("level1","assets/levels/level_1.json"),this.load.json("level2","assets/levels/level_2.json"),this.load.json("big_level1","assets/levels/big_level1.json"),this.load.json("big_level2","assets/levels/big_level2.json"),this.load.json("big_level3","assets/levels/big_level3.json")}create(){this.scene.start("MainScene");const e=this.cache.json.get("level0"),t=this.cache.json.get("level1"),s=this.cache.json.get("level2"),i=this.cache.json.get("big_level1"),r=this.cache.json.get("big_level2"),a=this.cache.json.get("big_level3");m.addLevel(e),m.addLevel(t),m.addLevel(s),m.addLevel(i),m.addLevel(r),m.addLevel(a),m.setLevelIndex(0)}}const _e={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:960,height:1554},scene:[ve,be]};window.addEventListener("load",(()=>{new Phaser.Game(_e)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,r,a)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,r,a]=e[h],n=!0,l=0;l<s.length;l++)(!1&a||o>=a)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(n=!1,a<o&&(o=a));if(n){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,r,a]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,a,[o,n,l]=s,c=0;if(o.some((t=>0!==e[t]))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(l)var h=l(i)}for(t&&t(s);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(403)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();